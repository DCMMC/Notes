% !TeX encoding = UTF-8
% !TeX program = xelatex
% !TeX spellcheck = en_US

\documentclass[degree=project,degree-type=project,cjk-font=noto]{thuthesis}
\usepackage{mathtools}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows}
\usepackage[autosize]{dot2texi}
% Syntax Highlighting in LaTeX, need pygments
% Must build with xelatex -shell-escape -enable-8bit-chars.
\usepackage{minted}
% https://tex.stackexchange.com/a/112573
\usepackage{tcolorbox}
\usepackage{etoolbox}
\BeforeBeginEnvironment{minted}{\begin{tcolorbox}}%
\AfterEndEnvironment{minted}{\end{tcolorbox}}%
% color for minted
\definecolor{friendlybg}{HTML}{f0f0f0}


% è®ºæ–‡åŸºæœ¬é…ç½®ï¼ŒåŠ è½½å®åŒ…ç­‰å…¨å±€é…ç½®
\thusetup{
    output = electronic,
    title  = {å®éªŒä¸€},
    author  = {è‚–æ–‡éŸ¬},
    studentid = {2020214245},
    major = {ç”µå­ä¿¡æ¯ï¼ˆè®¡ç®—æœºæŠ€æœ¯ï¼‰},
    email = {xwt20@mails.tsinghua.edu.cn},
    course = {å¯†ç å­¦ä¸ç½‘ç»œå®‰å…¨},
    include-spine = false,
}


\usepackage{float}
\usepackage[sort]{natbib}
\bibliographystyle{thuthesis-numeric}
\graphicspath{{figures/}}


\setlist[enumerate,1]{label=\arabic*.}
\setlist[enumerate,2]{label=(\alph*)}
\setlist[enumerate,3]{label=\roman*.}
\setlist[enumerate,4]{label=\greek*}

\newcommand*\justify{%
  \fontdimen2\font=0.4em% interword space
  \fontdimen3\font=0.2em% interword stretch
  \fontdimen4\font=0.1em% interword shrink
  \fontdimen7\font=0.1em% extra space
  \hyphenchar\font=`\-% allowing hyphenation
}

\renewcommand{\texttt}[1]{%
  \begingroup
  \ttfamily
  \begingroup\lccode`~=`/\lowercase{\endgroup\def~}{/\discretionary{}{}{}}%
  \begingroup\lccode`~=`[\lowercase{\endgroup\def~}{[\discretionary{}{}{}}%
  \begingroup\lccode`~=`.\lowercase{\endgroup\def~}{.\discretionary{}{}{}}%
  \catcode`/=\active\catcode`[=\active\catcode`.=\active
  \justify\scantokens{#1\noexpand}%
  \endgroup
}


\begin{document}

% å°é¢
\maketitle

\frontmatter
% \input{data/abstract}

% ç›®å½•
% \tableofcontents

% æ’å›¾å’Œé™„è¡¨æ¸…å•
% \listoffiguresandtables
% \listoffigures           % æ’å›¾æ¸…å•

% æ­£æ–‡éƒ¨åˆ†
\mainmatter

\chapter{å®éªŒä»‹ç»}
AESåŠ å¯†ç®—æ³•æ˜¯è¿­ä»£å‹åˆ†ç»„å¯†ç ç®—æ³•ï¼Œæ¶‰åŠ4ç§æ“ä½œï¼šå­—èŠ‚æ›¿ä»£ã€è¡Œç§»ä½ã€åˆ—æ··åˆå’Œè½®å¯†é’¥åŠ ã€‚
æœ¬æ¬¡å®éªŒä¸­å¯†é’¥é•¿åº¦å’Œåˆ†ç»„é•¿åº¦éƒ½ä¸º128æ¯”ç‰¹ï¼ŒåŠ å¯†è½®æ•°ä¸º10è½®ã€‚
å®éªŒä½¿ç”¨ Rust è¯­è¨€å®ç° AES128 çš„åŠ å¯†è§£å¯†æ“ä½œã€‚

å®éªŒç›®çš„ï¼š

\begin{enumerate}
    \item ç†Ÿç»ƒæŒæ¡AESåŠ å¯†ç®—æ³•çš„ç†è®º
    \item å­¦ä¹  rust è¯­è¨€çš„åŸºæœ¬ç”¨æ³•
\end{enumerate}

å®éªŒå¹³å°ï¼š

\begin{enumerate}
    \item rust è¯­è¨€
    \item Arch Linux (ä¸ä¾èµ–å…·ä½“æ“ä½œç³»ç»Ÿï¼Œrust äº¦å¯åœ¨ windows/macOS ä¸Šä½¿ç”¨)
\end{enumerate}

\chapter{å®éªŒå†…å®¹}

\section{å­—èŠ‚æ›¿ä»£å˜æ¢å’Œé€†å­—èŠ‚æ›¿ä»£å˜æ¢}

    æ ¹æ®16Ã—16çš„å­—èŠ‚æ›¿ä»£çŸ©é˜µå’Œé€†æ›¿ä»£çŸ©é˜µï¼Œå¯¹äºæ¯ä¸ªå­—èŠ‚ï¼Œå°†å…¶å‰4bitä½œä¸ºæ¨ªåæ ‡ï¼Œå4bitä½œä¸ºçºµåæ ‡ï¼Œä½¿ç”¨ä¸‹æ–¹æ›¿ä»£çŸ©é˜µå¯¹åº”ä½ç½®çš„å­—èŠ‚è¿›è¡Œæ›¿ä»£ã€‚å®Œæˆå¯¹ä¸€ä¸ªé•¿æ–‡æœ¬çš„å­—èŠ‚æ›¿ä»£å˜æ¢å’Œé€†å­—èŠ‚æ›¿ä»£å˜æ¢ï¼Œå¯¹äºä¸è¶³16å­—ç¬¦çš„è¾“å…¥éœ€è¦è¡¥ä½ï¼Œä¸ºäº†æ–¹ä¾¿ä¹‹åçš„åŠ è§£å¯†ï¼Œ16å­—èŠ‚çš„æ–‡æœ¬åº”è½¬æ¢ä¸º4Ã—4çš„å­—èŠ‚çŸ©é˜µã€‚

{\heiti è§£ï¼š}

å› ä¸º AES128 æ˜¯ä½œç”¨äºå—å¤§å°ä¸º 128 bits çš„å—åŠ å¯†ç®—æ³•ã€‚
æ‰€ä»¥æœ¬é¢˜é¦–å…ˆéœ€è¦å®ç°å°†æ˜æ–‡æ¶ˆæ¯åˆ†å—ï¼Œå¹¶ä¸”å¯¹äºæœ€åä¸€å—ä¸è¶³ 16 å­—èŠ‚æ—¶è¿›è¡Œè¡¥ä½ã€‚
å†å¯¹æ¯ä¸€å—è¿›è¡Œå­—èŠ‚æ›¿ä»£ï¼Œå†è¿›è¡Œé€†å­—èŠ‚æ›¿ä»£ã€‚
æœ€åè¿›è¡Œé€†è¡¥ä½å¾—åˆ°åŸæ–‡ã€‚

\subsection{è¡¥ä½}

  \begin{minted}[texcomments,tabsize=2,fontsize=\normalsize,style=friendly,bgcolor=friendlybg]{rust}
fn pad(states: &mut Vec<u8>) -> () {
  let mut pad_size = states.len() % BLOCK_SIZE;
  if pad_size != 0 {
      pad_size = BLOCK_SIZE - pad_size;
  }
  states.extend(vec![PAD_BYTE; pad_size]);
}
  \end{minted}

å…¶ä¸­ \texttt{PAD\_BYTE} ä¸º $0$ï¼Œå³ç”¨ $0$ æ¥è¡¥ä½ï¼Œ\texttt{BLOCK\_SIZE} ä¸º $16$ å­—èŠ‚ï¼Œå³ $128$ bitsã€‚

\subsection{å­—èŠ‚æ›¿ä»£}

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn sub_bytes(states: &mut Vec<u8>) -> () {
  for idx in 0..states.len() {
      let b = states[idx];
      states[idx] = SBOX[(b >> 4) as usize][(b & 0x0f) as usize];
  }
}
  \end{minted}

å…¶ä¸­ SBOX æ˜¯æå‰ç»™å®šçš„ï¼ŒSBOX å°±æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œç¬¬ä¸€ç»´å°±æ˜¯å­—èŠ‚çš„é«˜ 4 ä½ï¼Œç¬¬äºŒç»´å°±æ˜¯å­—èŠ‚çš„ä½ 4 ä½ï¼Œå…·ä½“çš„ SBOX å®šä¹‰è§æºä»£ç /å®éªŒä¹¦ã€‚

\subsection{é€†å­—èŠ‚æ›¿ä»£}

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn inv_sub_bytes(states: &mut Vec<u8>) -> () {
    for idx in 0..states.len() {
        let b = states[idx];
        states[idx] = INV_SBOX[(b >> 4) as usize][(b & 0x0f) as usize];
    }
}
  \end{minted}

INV\_SBOX å°±æ˜¯æ ¹æ® SBOX å¯¹åº”çš„é€†æ›¿æ¢è¡¨ã€‚

\subsection{é€†è¡¥ä½}

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn unpad(states: &mut Vec<u8>) -> () {
    let blocks = states.chunks_mut(BLOCK_SIZE);
    let last_block: &mut [u8] = blocks.last().unwrap();
    let padding_len = BLOCK_SIZE - match last_block.iter().position(
        |&x| x == PAD_BYTE) {
        Some(pos) => pos,
        None => BLOCK_SIZE,
    };
    for _ in 0..padding_len {
        states.remove(states.len() - 1);
    }
}
  \end{minted}

é€†è¡¥ä½ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œé¦–å…ˆéœ€è¦åœ¨é€†å˜æ¢åçš„è¡¥ä½é•¿åº¦ï¼Œç„¶åå°†è¡¥ä½éƒ¨åˆ†æˆªæ–­å³å¯ã€‚

\subsection{è¿è¡Œç»“æœ}

\begin{figure}[h]
\centering%
\includegraphics[width=.4\linewidth]{aes_t1.png}
  \caption{å­—èŠ‚æ›¿æ¢è¿è¡Œç»“æœ}
  \label{fig:t1}
\end{figure}

æœ¬é¢˜ä½¿ç”¨å­—ç¬¦ä¸²'abcdefghijklmn'ä½œä¸ºè¾“å…¥ï¼Œå®Œæˆå­—ç¬¦ä¸²çš„è¡¥ä½ã€è½¬ç ã€å­—èŠ‚æ›¿ä»£ã€é€†å­—èŠ‚æ›¿ä»£ã€è½¬ç ã€å»è¡¥ä½ï¼Œè¾“å‡ºæ¯ä¸€æ­¥çš„ç»“æœã€‚
è¿è¡Œç»“æœå¦‚å›¾~\ref{fig:t1}æ‰€ç¤ºã€‚

\section{è¡Œç§»ä½å˜æ¢å’Œé€†è¡Œç§»ä½å˜æ¢ï¼Œåˆ—æ··åˆå’Œé€†åˆ—æ··åˆ}

ç¼–å†™å¯¹4Ã—4å­—èŠ‚çŸ©é˜µçš„è¡Œç§»ä½å˜æ¢å’Œé€†è¡Œç§»ä½å˜æ¢ä»£ç ã€‚ç¼–å†™å¯¹4Ã—4å­—èŠ‚çŸ©é˜µçš„åˆ—æ··åˆå’Œé€†åˆ—æ··åˆä»£ç ï¼Œåˆ—æ··åˆéœ€è¦ä½¿ç”¨xä¹˜æ³• ï¼ˆxtimeï¼‰ã€‚

\subsection{è¡Œç§»ä½å˜æ¢}

è¡Œç§»ä½å°±æ˜¯å°†æ¯ä¸€å—ï¼ˆblockï¼‰ç”¨çŠ¶æ€çŸ©é˜µï¼ˆstateï¼‰è¡¨ç¤ºï¼Œç„¶åå¯¹æ¯ä¸€è¡Œåšä¸€äº›ç®€å•çš„å¾ªç¯å·¦ç§»è¿ç®—ã€‚
å…·ä½“çš„ï¼Œç¬¬ä¸€è¡Œä¸ç§»ä½ï¼Œç¬¬äºŒè¡Œå¾ªç¯å·¦ç§»ä¸€ä½ï¼Œç¬¬ä¸‰è¡Œå¾ªç¯å·¦ç§»ä¸¤ä½ï¼Œç¬¬å››è¡Œå¾ªç¯å·¦ç§»ä¸‰ä½ã€‚

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn shift_rows(states: &mut Vec<u8>) -> () {
    let blocks = states.chunks_mut(BLOCK_SIZE);
    for state in blocks {
        let mut temp: u8;
        // row 1
        temp = state[1];
        state[1] = state[5];
        state[5] = state[9];
        state[9] = state[13];
        state[13] = temp;
        // row 2
        temp = state[2];
        state[2] = state[10];
        state[10] = temp;
        temp = state[6];
        state[6] = state[14];
        state[14] = temp;
        // row 3
        temp = state[15];
        state[15] = state[11];
        state[11] = state[7];
        state[7] = state[3];
        state[3] = temp;
    }
}
  \end{minted}

\subsection{åˆ—æ··åˆ}

åœ¨åˆ—æ··åˆä¸­ï¼ŒçŠ¶æ€çŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½å¯ä»¥çœ‹ä½œæ˜¯ $GF(2^8)$ æœ‰é™åŸŸä¸Šçš„å¤šé¡¹å¼ï¼Œä¸”æœ€é«˜é¡¹æ¬¡æ•°ä¸è¶…è¿‡ $7$ã€‚
åœ¨ $GF(2^8)$ ä¸Šä¹˜ä»¥å¦å¤–ä¸€ä¸ªæ¨¡å¤šé¡¹å¼ $c(x)$ å†å–æ¨¡å¯ä»¥å†™ä½œä¸€ä¸ªçŸ©é˜µè¿ç®—ï¼ˆç”± $GF(2^8)$ ä¸Šå®šä¹‰çš„ä¹˜æ³•å®ç°çš„ï¼‰ã€‚
å¯¹äº è¾“å…¥å¤šé¡¹å¼ $a(x)$ï¼Œä¹˜ä»¥æ¨¡å¤šé¡¹å¼ $c(x) = '03'x^3+'01'x^2+'01'x+'02'$ å¯ä»¥è¡¨ç¤ºä¸ºï¼š
\begin{align}
  \begin{split}
    b(x) &= c(x) \otimes a(x) \\
    &= \begin{bmatrix}
      02 & 03 & 01 & 01 \\
      01 & 02 & 03 & 01 \\
      01 & 01 & 02 & 03 \\
      03 & 01 & 01 & 02
    \end{bmatrix} \begin{bmatrix}
      a_0 \\
      a_1 \\
      a_2 \\
      a_3
    \end{bmatrix}
  \end{split}
\end{align}

æ³¨æ„ $GF(2^8)$ ä¸Šçš„åŠ æ³•å°±æ˜¯å¼‚æˆ–è¿ç®—ã€‚
åŒæ—¶ï¼Œ$GF(2^8)$ ä¸Šä¸€ä¸ªå¤šé¡¹å¼ä¹˜ä»¥ä»»æ„å¤šé¡¹å¼ï¼ˆä»»æ„å¸¸æ•°ï¼‰éƒ½å¯ä»¥å½’çº¦ä¸ºä¹˜ä»¥å¸¸æ•° '02' (ä¹Ÿå°±æ˜¯å¤šé¡¹å¼ $x$ï¼Œä¹Ÿå«åš x ä¹˜æ³•)å’Œ '01' (é‚£å°±æ˜¯æœ¬èº«å•¦ï¼‰ã€‚
ä¾‹å¦‚ï¼Œä¸Šé¢çŸ©é˜µçš„ç»“æœä¸­ï¼Œæœ‰ä»¥ä¸‹æ¨å¯¼ï¼š

\begin{align*}
    b_0 &= '02' \cdot a_0 + '03' \cdot a_1 + '01' \cdot a_2 + '01' \cdot a_3 \\
    '02' \cdot a_0 + a_1 \cdot ('01' + '02') + a_2 + a_3 \\
    &= (a_0 + a_1) \cdot '02' + a_1 + a_2 + a_3 \\
    &= (a_0 + a_1) \cdot '02' + a_0 + a_0 + a_1 + a_2 + a_3
\end{align*}
å…¶ä¸­ $GF(2^8)$ ä¸Šçš„åŠ æ³•è¿ç®—å°±æ˜¯äºŒè¿›åˆ¶çš„é€ä½å¼‚æˆ–ï¼ˆxorï¼‰ï¼Œè¿™é‡Œé¢åˆ©ç”¨äº†ä¸€äº›å¼‚æˆ–çš„æ€§è´¨å°±ä¸å†å±•å¼€äº†ï¼Œæ¯”è¾ƒå®¹æ˜“è‡ªå·±æ¨å¯¼å‡ºæ¥ã€‚

x ä¹˜æ³•ï¼ˆxtimeï¼‰çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn xtime(b: u8) -> u8 {
    let c;
    if (b & 0x80) != 0 {
        c = (b << 1) ^ 0x1b;
    } else {
        c = b << 1;
    };
    c
}
  \end{minted}

ä»£ç çœ‹èµ·æ¥æ˜¯ç®€å•ï¼Œä¸è¿‡æ¨å¯¼èµ·æ¥æœ‰ä¸å°‘æ­¥éª¤ã€‚
é¦–å…ˆ $GF(2^8)$ ä¸Šçš„æ•°ï¼Œå°±æ˜¯å¯¹åº”ä¸€ä¸ªå¤šé¡¹å¼ï¼Œä¾‹å¦‚ $'1B' (0b0001\_1011)$ å°±å¯¹åº”å¤šé¡¹å¼ $x^4 + x^3 + x + 1$ã€‚
ä¸¤ä¸ª $GF(2^8)$ ä¸Šçš„æ•°ç›¸ä¹˜ï¼Œå°±æ˜¯å¯¹åº”ä»–ä»¬çš„å¤šé¡¹å¼åœ¨ $\mathbb{R}$ ä¸Šçš„æ™®é€šä¹˜æ³•ã€‚
æ¯”å¦‚ x ä¹˜æ³•å°±æ˜¯å°†æ•°ä¹˜ä»¥å¤šé¡¹å¼ $x$ (ä¹Ÿå°±æ˜¯ '02')ï¼Œä¾‹å¦‚ $'1B' \cdot '02' = (x^4 + x^3 + x + 1) x = x^5 + x^4 + x^2 + x = 0b0011\_0110 = '54'$ï¼Œå…¶å®å°±æ˜¯äºŒè¿›åˆ¶å·¦ç§»ä¸€ä½.
è¿˜æœ‰å°±æ˜¯å–æ¨¡è¿ç®—ä¹Ÿä¸ç”¨äº $\mathbb{R}$ ä¸Šçš„å–æ¨¡ï¼Œ$GF(2^8)$ ä¸Šçš„å–æ¨¡ç¬¼ç»Ÿåœ°æ¥è¯´å°±æ˜¯ç”¨å¼‚æˆ–å®ç°çš„é™¤æ³•ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œè®¡ç®— $'B3' \cdot '02' \;(\bmod\; '11B') = 0b1011\_0011 \ll 2 \;(\bmod\; 0b1\_0001_1011) = 0b1\_0110\_0110 \;(\bmod 0b1\_0001\_1011)$ è¿‡ç¨‹å¦‚ä¸‹ï¼š

{\tt
{\noindent-------------}\\
\phantom{0 }1 0110 0110 (mod) 1 0001 1011 \\
\textasciicircum\phantom{ }1 0001 1011 \\
------------- \\
\phantom{0 }0 0111 1101
}

å…¶ä¸­ä¸Šé¢çš„ $\textasciicircum$ å°±æ˜¯å¼‚æˆ–è¿ç®—ã€‚
åˆå› ä¸º $GF(2^8)$ æœ€é«˜é˜¶å°±æ˜¯ $x^7$ (äºŒè¿›åˆ¶çš„æœ€é«˜ä½), è€Œæ¨¡å¤šé¡¹å¼ $'11B'$ å¯¹åº”çš„æœ€é«˜é˜¶æ˜¯ $x^8$ï¼Œä¹Ÿå°±æ˜¯å¤šä¸€ä½ã€‚
æ‰€ä»¥ x ä¹˜æ³•çš„è¢«ä¹˜å‡ºåªæœ‰ä¸¤ç§å¯èƒ½ï¼šï¼ˆ1ï¼‰æœ€é«˜ä½æ˜¯ $0$ï¼Œåˆ™å·¦ç§»ä¸€ä½ä¹Ÿä¸ä¼šè¶…è¿‡ $'11B'$ï¼Œæ‰€ä»¥å–æ¨¡åä»æœªåŸæ•°ï¼Œï¼ˆ2ï¼‰æœ€é«˜ä½æ˜¯ $1$ï¼Œåˆ™å·¦ç§»ä¸€ä½åå¯èƒ½ä¼šå¤§äºæ¨¡å¤šé¡¹å¼ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸Šè¿°å–æ¨¡çš„è¿‡ç¨‹ï¼Œä¸æ¨¡å¤šé¡¹å¼è¿›è¡Œä¸€æ¬¡å¼‚æˆ–è¿ç®—ã€‚
ç»¼ä¸Šï¼Œè¿™ä¸ªä»£ç é€»è¾‘å°±å¾ˆå¥½ç†è§£äº†ã€‚

æœ‰äº† x ä¹˜æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºä¹˜ä»¥ä»»æ„å¤šé¡¹å¼çš„ç®—æ³•äº†ï¼Œä¸‹é¢çš„ä»£ç å°±æ˜¯åˆ—æ··æ·†çš„æœ€ç»ˆå®ç°ã€‚

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn mix_columns(states: &mut Vec<u8>) {
    let blocks = states.chunks_mut(BLOCK_SIZE);
    for state in blocks {
        let columns = state.chunks_mut(ROW_COUNT);
        for column in columns {
            let tmp = column[0] ^ column[1] ^ column[2] ^ column[3];
            let bak_c0 = column[0];
            column[0] = xtime(column[0] ^ column[1]) ^ column[0] ^ tmp;
            column[1] = xtime(column[1] ^ column[2]) ^ column[1] ^ tmp;
            column[2] = xtime(column[2] ^ column[3]) ^ column[2] ^ tmp;
            column[3] = xtime(column[3] ^ bak_c0) ^ column[3] ^ tmp;
        }
    }
}
  \end{minted}


\subsection{é€†åˆ—æ··åˆ}

åŒæ ·çš„ï¼Œç±»ä¼¼äºåˆ—æ··æ·†ï¼Œé€†åˆ—æ··æ·†ä¹Ÿæ˜¯ä¸€ä¸ªçŸ©é˜µè¿ç®—ï¼Œåªä¸è¿‡æ˜¯çŸ©é˜µæ˜¯å¦å¤–ä¸€ä¸ªï¼Œè¿ç®—è¿‡ç¨‹ä¸ºï¼š
\begin{align}
  \begin{split}
    b(x) &= c(x) \otimes a(x) \\
    &= \begin{bmatrix}
0e & 0b & 0d & 09 \\
09 & 0e & 0b & 0d \\
0d & 09 & 0e & 0b \\
0b & 0d & 09 & 0e \\
    \end{bmatrix} \begin{bmatrix}
      a_0 \\
      a_1 \\
      a_2 \\
      a_3
    \end{bmatrix}
  \end{split}
\end{align}

ä»çŸ©é˜µå¯ä»¥çœ‹å‡ºæ¥ï¼Œå¦‚æœç”¨ x ä¹˜æ³•æ¥å®ç°ä¸Šé¢çš„å¤šé¡¹å¼ä¹˜æ³•æ¯”åˆ—æ··æ·†è¦å¤æ‚å¾ˆå¤šï¼Œå› ä¸ºéƒ½æ˜¯ä¹˜ä»¥ $0e$, $0d$ è¿™æ ·çš„æ¯”è¾ƒå¤§çš„æ•°ï¼Œéœ€è¦çš„ x ä¹˜æ³•ä¹Ÿè‡ªç„¶ä¼šå¤šä¸€äº›ã€‚
AES ä¸“åˆ©è®ºæ–‡ä¸­æœ‰ç›¸åº”çš„ä¼˜åŒ–ç®—æ³•ï¼Œä¸è¿‡æˆ‘åœ¨ä»£ç†é‡Œé¢ä»ç„¶ä½¿ç”¨çš„æ˜¯æœ€ naive çš„å®ç°æ–¹æ³•ã€‚

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn inv_mix_columns(states: &mut Vec<u8>) {
    let blocks = states.chunks_mut(BLOCK_SIZE);
    for state in blocks {
        let columns = state.chunks_mut(ROW_COUNT);
        for column in columns {
            let mut t = column[0] ^ column[1] ^ column[2] ^ column[3];
            let u = xtime(xtime(column[0] ^ column[2]));
            let v = xtime(xtime(column[1] ^ column[3]));
            let bak_c0 = column[0];
            column[0] = t ^ column[0] ^ xtime(column[0] ^ column[1]);
            column[1] = t ^ column[1] ^ xtime(column[1] ^ column[2]);
            column[2] = t ^ column[2] ^ xtime(column[2] ^ column[3]);
            column[3] = t ^ column[3] ^ xtime(column[3] ^ bak_c0);
            t = xtime(u ^ v);
            column[0] ^= t ^ u;
            column[1] ^= t ^ v;
            column[2] ^= t ^ u;
            column[3] ^= t ^ v;
        }
    }
}
  \end{minted}

\subsection{é€†è¡Œç§»ä½å˜æ¢}

é€†è¡Œç§»ä½å˜æ¢å°±æ˜¯è¡Œç§»ä½è¿ç®—çš„é€†è¿‡ç¨‹ï¼Œå°±æ˜¯å°†ä¹‹å‰çš„å¾ªç¯å·¦ç§»å˜æˆå¾ªå³ç§»ã€‚

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn inv_shift_rows(states: &mut Vec<u8>) -> () {
    let blocks = states.chunks_mut(BLOCK_SIZE);
    for state in blocks {
        let mut temp: u8;
        temp = state[13];
        state[13] = state[9];
        state[9] = state[5];
        state[5] = state[1];
        state[1] = temp;
        temp = state[14];
        state[14] = state[6];
        state[6] = temp;
        temp = state[10];
        state[10] = state[2];
        state[2] = temp;
        temp = state[3];
        state[3] = state[7];
        state[7] = state[11];
        state[11] = state[15];
        state[15] = temp;
    }
}
  \end{minted}

\subsection{è¿è¡Œç»“æœ}

æœ¬é¢˜ä½¿ç”¨å­—ç¬¦ä¸²'abcdefghijklmnop'ä½œä¸ºéªŒè¯è¾“å…¥ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—èŠ‚çŸ©é˜µåå¯¹å››ä¸ªå˜æ¢è¿›è¡ŒéªŒè¯ï¼Œè®°å½•å…¶è¾“å‡ºã€‚
è¡Œç§»ä½å˜æ¢å’Œåˆ—æ··åˆè¿è¡Œç»“æœå¦‚å›¾~\ref{fig:t2}æ‰€ç¤ºã€‚

\begin{figure}[h]
\centering%
\includegraphics[width=.3\linewidth]{aes_t2.png}
  \caption{è¡Œç§»ä½å˜æ¢å’Œåˆ—æ··åˆè¿è¡Œç»“æœ}
  \label{fig:t2}
\end{figure}

\section{è½®å¯†é’¥ç”Ÿæˆ}

\subsection{è½®å¯†é’¥ç”Ÿæˆç®—æ³•}

ä¸ºäº†æŠŠä¸€ä¸ª 128 bits çš„å¯†é’¥æ‰©å±•åˆ° AES128 çš„ 10 è½®è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯†é’¥æ‰©å±•ç®—æ³•, æŠŠåŸå§‹å¯†é’¥å†æ‰©å±•å‡º 10 ä¸ªè½®å¯†é’¥ï¼ˆround keyï¼‰ã€‚
å…¶å® AES çš„å¯†é’¥æ‰©å±•æ¯”è¾ƒç®€å•ï¼Œä»ç„¶ä½¿ç”¨çš„æ˜¯ RotByte å­—èŠ‚å¾ªç¯å³ç§»ï¼ˆ4ä¸ªå­—èŠ‚æ„æˆä¸€ç»„ï¼Œæˆ–è€…è¯´ state ä¸­çš„ä¸€åˆ—ï¼‰å’Œ ä½¿ç”¨ SBOX çš„ SubByte å­—èŠ‚æ›¿æ¢æ¥å®ç°çš„ã€‚
åœ¨æœ€åè¿˜è¦å†åŠ ä¸Šï¼ˆå¼‚æˆ–ï¼‰ RCON ä¸­è§„å®šçš„ $GF(2^8)$ å¤šé¡¹å¼ã€‚

å…·ä½“æ¥è¯´ï¼Œæ¯ä¸€è½®å°†ç”Ÿæˆ 16 å­—èŠ‚é•¿åº¦çš„å¯†é’¥ï¼Œæ¯ä¸€ä¸ªè½®å¯†é’¥çš„å‰ 4 ä¸ªå­—èŠ‚ä¸ºå‰é¢å››ä¸ªå­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªè½®å¯†é’¥çš„æœ€å 4 ä¸ªå­—èŠ‚ï¼‰å…ˆ RotByte å† SubByte ï¼Œå¹¶ä¸”æœ€åè¿˜è¦å¯¹ç¬¬ä¸€ä¸ªå­—èŠ‚åŠ ä¸Šï¼ˆå¼‚æˆ–ï¼‰\texttt{Rcon[i]} (i è¡¨ç¤ºå½“å‰ä¸ºç¬¬ i è½®)ã€‚
\texttt{Rcon[i]} ç›´æ¥å¯ä»¥ç”¨é¢˜ç›®ç»™çš„é‚£ä¸ªæ•°ç»„ï¼Œå…·ä½“çš„è®¡ç®—å…¬å¼è§ AES ä¸“åˆ©è®ºæ–‡~\cite{aes}ã€‚ 

ä»£ç å®ç°å¦‚ä¸‹ï¼Œ

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn key_schedule(cipher_key: &[u8; BLOCK_SIZE]) -> [u8; (ROUND + 1) * BLOCK_SIZE] {
    let mut round_keys = [0u8; (ROUND + 1) * BLOCK_SIZE];
    for i in 0..BLOCK_SIZE { round_keys[i] = cipher_key[i]; }
    for i in 1..(ROUND + 1) {
        // last 4 bytes (one word), i.e., last column
        let mut temp_offset: usize = i * 16 - 4;
        // last round (16 bytes), i.e., last round key
        let mut last_round: usize = (i - 1) * 16;
        // RotByte is cyclic right shift, e.g., (a, b, c, d) => (b, c, d, a)
        round_keys[i * 16] = sub_byte(round_keys[temp_offset + 1]) ^ RCON[i] ^ round_keys[
            last_round + 1];
        round_keys[i * 16 + 1] = sub_byte(round_keys[temp_offset + 2]) ^ round_keys[
            last_round + 2];
        round_keys[i * 16 + 2] = sub_byte(round_keys[temp_offset + 3]) ^ round_keys[
            last_round + 3];
        round_keys[i * 16 + 3] = sub_byte(round_keys[temp_offset]) ^ round_keys[
            last_round];
        for j in 1..4 {
            temp_offset += 4;
            last_round += 4;
            round_keys[i * 16 + j * 4] = round_keys[last_round] ^ round_keys[temp_offset];
            round_keys[i * 16 + j * 4 + 1] = round_keys[last_round + 1] ^ round_keys[
                temp_offset + 1];
            round_keys[i * 16 + j * 4 + 2] = round_keys[last_round + 2] ^ round_keys[
                temp_offset + 2];
            round_keys[i * 16 + j * 4 + 3] = round_keys[last_round + 3] ^ round_keys[
                temp_offset + 3];
        }
    }
    round_keys
}
\end{minted}

\subsection{è¿è¡Œç»“æœ}

ä½¿ç”¨åŸå§‹å¯†é’¥'abcdefghijklmnop'ç”Ÿæˆæ€»è®¡11ç»„æ‰©å±•å¯†é’¥ï¼Œå°†ç”¨äºä¹‹åçš„åŠ è§£å¯†ã€‚åˆå§‹å¯†é’¥Kè½¬æ¢ä¸ºå­—èŠ‚çŸ©é˜µåçš„4åˆ—ä¸º $W\_0 \sim W\_3$ï¼Œåç»­çš„ $W\_4 \sim W\_{43}$ ä½¿ç”¨é€’å½’è®¡ç®—å¾—åˆ°ã€‚
è®¡ç®—ç»“æœå¦‚å›¾~\ref{fig:t3}æ‰€ç¤ºã€‚

\begin{figure}[h]
\centering%
\includegraphics[width=\linewidth]{aes_t3.png}
  \caption{è½®å¯†é’¥ç”Ÿæˆè¿è¡Œç»“æœ}
  \label{fig:t3}
\end{figure}

\section{åŠ å¯†æœºå’Œè§£å¯†æœº}

\subsection{ä»£ç å®ç°}

åŠ å¯†å’Œè§£å¯†çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œå°±æ˜¯æŠŠä¹‹å‰çš„é‚£äº›åŠŸèƒ½æ•´åˆåˆ°ä¸€èµ·ã€‚
åŠ å¯†è¿‡ç¨‹åŒ…å«å­—èŠ‚å¡«å……ï¼Œ10 è½®åŠ å¯†ï¼Œå…¶ä¸­å‰ 9 è½®éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæœ€åä¸€è½®å·®åˆ«åœ¨äºæ²¡æœ‰åˆ—æ··æ·†è¿‡ç¨‹ã€‚
æ¯ä¸€è½®åŠ å¯†ä¾æ¬¡åŒ…æ‹¬å­—èŠ‚æ›¿æ¢ï¼Œè¡Œç§»ä½ï¼Œåˆ—æ··æ·†ï¼Œè½®å¯†é’¥åŠ ã€‚
è§£å¯†è¿‡ç¨‹å°±æ˜¯åŠ å¯†è¿‡ç¨‹çš„é€†è¿‡ç¨‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè½®å¯†é’¥çš„é¡ºåºä¹Ÿæ˜¯åè¿‡æ¥çš„ã€‚

å…·ä½“çš„åŠ å¯†æœºä»£ç å¦‚ä¸‹ï¼š

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn aes128_encrypt(plaintext: &str, cipher_key: &str) -> Vec<u8> {
    let mut states = plaintext.to_string().into_bytes();
    assert!(cipher_key.is_ascii());
    assert_eq!(cipher_key.len(), BLOCK_SIZE);
    let cipher: [u8; BLOCK_SIZE] = <[u8; BLOCK_SIZE]>::try_from(
        cipher_key.to_string().into_bytes()).unwrap();
    let round_keys = key_schedule(&cipher);
    pad(&mut states);
    // first AddRoundKey
    add_round_key(&mut states, &round_keys[0..BLOCK_SIZE]);
    // 9 rounds
    for i in 1..ROUND {
        sub_bytes(&mut states);
        shift_rows(&mut states);
        mix_columns(&mut states);
        add_round_key(&mut states, &round_keys[i * BLOCK_SIZE..(i + 1) * BLOCK_SIZE]);
    }
    // last round
    sub_bytes(&mut states);
    shift_rows(&mut states);
    add_round_key(&mut states, &round_keys[10 * BLOCK_SIZE..11 * BLOCK_SIZE]);
    states
}
\end{minted}

å…·ä½“çš„è§£å¯†æœºä»£ç å¦‚ä¸‹ï¼š

  \begin{minted}[texcomments,tabsize=2,fontsize=\footnotesize,style=friendly,bgcolor=friendlybg]{rust}
fn aes128_decrypt(cipher: &Vec<u8>, cipher_key: &str) -> String {
    let mut states = cipher.clone();
    assert!(cipher_key.is_ascii());
    assert_eq!(cipher_key.len(), BLOCK_SIZE);
    let key_array: [u8; BLOCK_SIZE] = <[u8; BLOCK_SIZE]>::try_from(
        cipher_key.to_string().into_bytes()).unwrap();
    let round_keys = key_schedule(&key_array);
    // from the last round to the first round
    let mut r_offset = BLOCK_SIZE * 10;
    // first AddRoundKey
    add_round_key(&mut states, &round_keys[r_offset..r_offset + BLOCK_SIZE]);
    inv_shift_rows(&mut states);
    inv_sub_bytes(&mut states);
    // 9 rounds
    for _ in 1..ROUND {
        r_offset -= BLOCK_SIZE;
        add_round_key(&mut states, &round_keys[r_offset..r_offset + BLOCK_SIZE]);
        inv_mix_columns(&mut states);
        inv_shift_rows(&mut states);
        inv_sub_bytes(&mut states);
    }
    // last round
    r_offset -= BLOCK_SIZE;
    add_round_key(&mut states, &round_keys[r_offset..r_offset + BLOCK_SIZE]);
    unpad(&mut states);
    let result_text = String::from_utf8(states.to_vec())
        .unwrap();
    result_text
}
\end{minted}
\subsection{è¿è¡Œç»“æœ}

æ•´åˆè½®å‡½æ•°ï¼Œå®ŒæˆAESåŠ å¯†å’Œè§£å¯†ï¼ŒåŸå§‹å¯†é’¥ä½¿ç”¨'abcdefghijklmnop'
æ˜æ–‡ä¸º 'Cryptography and Network Security; 2020214245; è‚–æ–‡éŸ¬ (Wentao Xiao) ğŸ‰ğŸš€' ï¼Œä½¿ç”¨è‡ªå·±çš„å­¦å·å’Œå§“åæ‹¼éŸ³æ›¿ä»£å¯¹åº”ä½ç½®å­—ç¬¦ä¸²ã€‚
æœ€ç»ˆåŠ å¯†æœºå’Œè§£å¯†æœºçš„è¿è¡Œç»“æœå¦‚å›¾~\ref{fig:t4}æ‰€ç¤ºã€‚

\begin{figure}[h]
\centering%
\includegraphics[width=\linewidth]{aes_t4.png}
  \caption{åŠ å¯†æœºå’Œè§£å¯†æœºè¿è¡Œç»“æœ}
  \label{fig:t4}
\end{figure}

% å…¶ä»–éƒ¨åˆ†
\backmatter

% å‚è€ƒæ–‡çŒ®
\bibliography{ref/refs}  % å‚è€ƒæ–‡çŒ®ä½¿ç”¨ BibTeX ç¼–è¯‘

\end{document}
